/* less2css - v0.0.8 - http://less2css.org/
 * Copyright (c) 2013 Brian Frichette. All rights reserved.
 * Licensed MIT - http://opensource.org/licenses/MIT
 */
Function.prototype.bind||_.extend(Function.prototype,{bind:function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}}),_.extend(Element.prototype,{getComputedStyle:function(a){var b=window.getComputedStyle(this);return b[a]},hasClosestEl:function(a){for(var b=this;b.parentElement;){if(b===a)return!0;b=b.parentElement}return!1},getClosest:function(a){for(var b=this;b.parentElement;){if(angular.element(b).hasClass(a))return b;b=b.parentElement}return null},getTop:function(){for(var a=this.offsetTop,b=this.offsetParent;b;)a+=b.offsetTop,b=b.offsetParent;return a},childElements:function(a){for(var b=this.querySelectorAll(a),c=_.toArray(this.children),d=[],e=b.length,f=0;e>f;)-1!==c.indexOf(b[f])&&d.push(b[f]),f++;return d.length?d:null}}),_.extend(String.prototype,{capitalize:function(){return this.charAt(0).toUpperCase()+this.slice(1)}}),function(a){function b(a){var b=a.expires;return null!==b&&b<=c()}function c(){return(new Date).getTime()}function d(a,b){if(null==a)throw Error("Storage Key Required");return this instanceof d?(this._key="__stor__"+a,this._ttl=b?b instanceof Date?b.getTime():b:null,this._sessionData=null,this._update(),void 0):new d(a,b)}"localStorage"in a||(a.localStorage={getItem:function(a){return this[a]||null},setItem:function(a,b){if(arguments.length<2)throw Error("localStorage.setItem requires (2) arguments");this[a]=""+b},removeItem:function(a){delete this[a]}});var e=a.localStorage,f="__stor__";for(var g in e)if(-1!==g.indexOf(f)){var h=JSON.parse(e[g]);b(h)&&(e.removeItem(g),console.log("Expiring from page load"))}d.prototype={get:function(){return this._data||this._sessionData},set:function(a,b){b=b||null==b;var c=this,d={data:a,expires:c._getExpires(b)},f=JSON.stringify(d);e.setItem(c._key,f),c._sessionData=null,c._update()},remove:function(){this._remove(),this._update()},_getExpires:function(a){var b=this;return a===!1&&b._previousExpires?b._previousExpires:b._ttl?c()+b._ttl:null},_get:function(){return JSON.parse(e.getItem(this._key))},_remove:function(){e.removeItem(this._key)},_update:function(){var a=this;if(null===a._sessionData){var c=a._get();if(!c)return a.set(null);if(b(c))return console.log("Expiring from session"),a._sessionData=a._data,a.remove();a._previousExpires=c.expires,a._data=c.data}}},a.Stor=d}(window),angular.module("Stor",[]).factory("Stor",["$q","$window","$timeout","$rootScope",function(a,b,c,d){var e=b.Stor;return _.extend(e.prototype,{getAsync:function(b){var e,f={},g=this,h=g.get.call(g),i=a.defer();if(h){var j=a.defer();e=j.promise,c(function(){j.resolve({data:h,status:200,type:"local"})},1,!1)}else e=b(),f.type="xhr";return e.then(function(a){return d.$safeApply(function(){_.extend(f,a),i.resolve(f)})}),i.promise}}),e}]),angular.module("TransitionHelper",[]).service("TransitionHelper",["$window","$document",function(a,b){function c(a){var b=f.documentElement.style;if(a in b)return a;var c=["Webkit","Moz","O","ms"],d=c.length,e=0;for(a=a.capitalize();d>e;){var g=c[e]+a;if(g in b)return g;e++}return a.toLowerCase()}function d(a){return _.isNumber(a)&&!_.isNaN(a)?a+"px":a}function e(a){var b=/[\d\.\-]+/g,c=a.match(b),d=c.length>6,e=d?c[14]:c[5],f=d?c[13]:c[4];return{X:parseFloat(f),Y:parseFloat(e)}}var f=b[0],g=this,h=g.props={transform:c("transform"),transition:c("transition"),transitionDuration:c("transitionDuration")};this.parseTransform=e,this.rAF=(a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}).bind(a),this.translate=function(a,b,c){var f=a.getComputedStyle(h.transform),g=d("X"===c?b:e(f).X),i=d("Y"===c?b:e(f).Y);a.style[h.transform]="translate3d("+g+","+i+",0)"},this.translate2d=function(a,b,c){var e=d(b),f=d(c);a.style[h.transform]="translate("+e+","+f+") translateZ(0)"},this.translateX=function(a,b){this.translate(a,b,"X")},this.translateY=function(a,b){this.translate(a,b,"Y")},this.transition=function(a,b){a.style[h.transition]=b},this.duration=function(a,b){if(null==b){var c=a.getComputedStyle(h.transitionDuration);return c.length?(c=_.reduce(c.split(","),function(a,b){return a+parseFloat(b)||0},0),1e3*c):0}"number"!=typeof b||isNaN(b)||(b+="ms"),a.style[h.transitionDuration]=b},this.transitionEnd=function(){var a={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd"};return a[h.transition]}()}]),angular.module("Less2Css",["Stor","TransitionHelper"]).config(["$provide",function(a){a.decorator("$rootScope",["$delegate",function(a){return a.$safeApply=function(){var b,c,d=arguments,e=!1;switch(d.length){case 1:var f=d[0];_.isFunction(f)?c=f:b=f;break;case 3:e=!!d[2];case 2:b=d[0],c=d[1]}b=b||a,c=c||_.noop,e||!b.$$phase?b.$apply?b.$apply(c):b.apply(c):c()},a}])}]),angular.module("Less2Css").service("LessLoader",["$q","$http","$window","$timeout",function(a,b,c,d){function e(a){c.eval.call(c,a)}var f={},g="/javascripts/less/less-{version}.js";_.extend(this,{load:function(h,i){c.less&&delete c.less,h=i?h+"-beta":h;var j=g.replace("{version}",h),k=a.defer();return h in f?(e(f[h]),d(function(){k.resolve()},1,!1),console.log("From cache loaded"),k.promise):(b.get(j).success(function(a){e(a),f[h]=a,k.resolve()}).error(function(){c.alert("There was a problem loading the selected Less file "+h),k.reject()}),k.promise)},isLoaded:function(){return!!c.less}})}]),angular.module("Less2Css").service("LessOptions",["$q","$http","Stor",function(a,b,c){function d(a){return!a.lastUpdate||a.lastUpdate+h<e()}function e(){return(new Date).getTime()}function f(a){_.extend(g.options,a)}var g=this,h=864e5,i=a.defer(),j=i.promise.then(f),k=30*h,l=c("LessOptions",k),m=l.get();m&&m.defaults?d(m)?b.get("/less-options").success(function(a){_.extend(m,{defaults:a,lastUpdate:e()}),_.defaults(m.options,m.defaults),m.options.versions=m.defaults.versions,l.set(m),i.resolve(m.options)}):i.resolve(m.options||m.defaults):b.get("/less-options").success(function(a){i.resolve(a),l.set({defaults:a})}),_.extend(g,{options:{},request:j,setCache:function(a){var b=l.get();b.options=a,l.set(b)}})}]),angular.module("Less2Css").factory("LessCompiler",["Stor","LessLoader",function(a,b){function c(){this.options={saveLess:!0},this.storage=d}var d=new a("LessEditorCache");return c.prototype={initLess:function(){this.parser=new less.Parser(this.lessOptions)},compileLess:function(a){if(!this.parser)return"";try{var b=this.parseLess(a,this.lessOptions);return this.error=!1,this.storage.set(a),b}catch(c){return this.error=!0,"file"===c.type.toLowerCase()&&this.initLess(),this.updateError(c)}},parseLess:function(a){var b=this.lessOptions,c="";return this.parser.parse(a,function(a,d){if(a)throw a;c=d.toCSS(b)}),c},updateOptions:function(a){this.lessOptions=a,b.isLoaded()&&this.initLess()},updateError:function(a){var b=a.type+" error: "+a.message+"\n"+(a.extract&&a.extract.join&&a.extract.join(""));return b},getCache:function(){return this.storage.get()}},new c}]),angular.module("Less2Css").directive("lessEditor",["LessOptions",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){function f(){var a=b.opts.lessEditorOptions,c=CodeMirror.fromTextArea(h,a);c.on("change",g(a.onChange)),e.$render=function(){c.setValue(e.$viewValue)}}function g(){return function(a){var c=a.getValue();c!==e.$viewValue&&(e.$setViewValue(c),b.$apply())}}var h=c[0];b.opts=a.options,e.$setViewValue(b.$eval(d.ngModel)||h.value),e.$render(),a.request.then(f)}}}]),angular.module("Less2Css").directive("drawer",["TransitionHelper",function(a){return{replace:!0,restrict:"E",transclude:!0,templateUrl:"drawer.html",scope:{open:"=",opts:"=",offset:"=",position:"="},link:function(b,c){function d(c){e();var d=c?b.offset:-b.height+_.parseInt(b.offset);a["translate"+g](f,d),f.style.opacity=c?1:0}function e(){b.height=f.offsetHeight,b.width=f.offsetWidth}var f=b.el=c[0],g="top"===b.position||"bottom"===b.position?"Y":"X";b.$watch("open",d)}}}]),angular.module("Less2Css").controller("AppCtrl",["$scope","LessOptions",function(a,b){a.opts=b.options,a.toggleDrawer=function(b){b.preventDefault(),a.drawerOpen=!a.drawerOpen}}]),angular.module("Less2Css").controller("OptionsCtrl",["$scope","$rootScope","LessOptions",function(a,b,c){function d(){_.defaults(i,i.options),i.lineNumbers=i.lineNumbers||i.lineNumberOptions[0].value,e()}function e(){i.selectedVersion=i.selectedVersion||_.find(i.versions,function(a){return"current"===a.type}).number}function f(){i.dumpLineNumbers=i.lineNumbersEnabled&&i.lineNumbers?i.lineNumbers:!1}function g(){i.rootpath=i.rootPathEnabled&&i.rootpathText?i.rootpathText:!1}function h(a){i.version=_.find(i.versions,function(b){return b.number===a})}var i=a.opts=c.options;c.request.then(d),_.extend(a,{resetOptions:["Options","Editor","Both"],toggleOption:function(a){i[a]=!i[a]},toggleTxt:function(a){return i[a]?"Enabled":"Disabled"},reset:function(a){b.$broadcast("Reset:"+a)}}),a.lessReset=a.resetOptions[0],a.$watch("opts.lineNumbers+opts.lineNumbersEnabled",f),a.$watch("opts.rootpathText+opts.rootpath",g),a.$watch("opts.selectedVersion",h)}]),angular.module("Less2Css").controller("Less2CssCtrl",["$scope","LessLoader","LessOptions","LessCompiler",function(a,b,c,d){function e(){i=a.opts=c.options,f(i),a.$watch("lessInput",h),a.$watch("opts.selectedVersion",g),a.$watch("opts",f,!0)}function f(a){d.updateOptions(a),c.setCache(a),h()}function g(){a.loading=!0,b.load(i.selectedVersion,"pre"===i.version.type).then(function(){d.initLess(),h(),a.loading=!1})}function h(){a.$safeApply(function(){_.extend(a,{cssOutput:d.compileLess(a.lessInput),compileError:d.error})})}var i;c.request.then(e),_.extend(a,{lessInput:d.getCache(),cssOutput:"",loading:!1,compileError:!1})}]);